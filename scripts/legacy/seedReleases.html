<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seed Test Releases</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background: #4F46E5;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 0;
    }
    button:hover {
      background: #4338CA;
    }
    button:disabled {
      background: #9CA3AF;
      cursor: not-allowed;
    }
    .log {
      background: #F3F4F6;
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .success { color: #059669; }
    .error { color: #DC2626; }
  </style>
</head>
<body>
  <h1>Seed Test Releases for F7</h1>
  <p>This will add 6 test releases with different statuses for testing the Ops Queues.</p>
  
  <button id="seedBtn">Seed Test Releases</button>
  <button id="clearBtn">Clear All Releases</button>
  
  <div id="log" class="log"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { 
      getFirestore, 
      collection, 
      addDoc, 
      serverTimestamp,
      getDocs,
      deleteDoc,
      doc
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    const firebaseConfig = {
      apiKey: "demo-api-key",
      authDomain: "cbrt-local.firebaseapp.com",
      projectId: "cbrt-local",
      storageBucket: "cbrt-local.appspot.com",
      messagingSenderId: "123456789",
      appId: "demo-app-id"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // Connect to emulator
    if (!window.firestoreEmulatorConnected) {
      const { connectFirestoreEmulator } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
      connectFirestoreEmulator(db, 'localhost', 8081);
      window.firestoreEmulatorConnected = true;
    }
    
    const log = document.getElementById('log');
    const seedBtn = document.getElementById('seedBtn');
    const clearBtn = document.getElementById('clearBtn');
    
    const addLog = (msg, type = '') => {
      const timestamp = new Date().toLocaleTimeString();
      log.innerHTML += `<span class="${type}">[${timestamp}] ${msg}</span>\n`;
      log.scrollTop = log.scrollHeight;
    };
    
    seedBtn.addEventListener('click', async () => {
      seedBtn.disabled = true;
      log.innerHTML = '';
      addLog('Starting seed process...');
      
      const releasesRef = collection(db, 'releases');
      
      const testReleases = [
        {
          ReleaseNumber: 'REL-001',
          number: 'REL-001',
          customerName: 'ABC Manufacturing',
          shipToName: 'Warehouse A',
          status: 'Entered',
          statusChangedAt: new Date(Date.now() - 3 * 60 * 60 * 1000), // 3 hours ago
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        },
        {
          ReleaseNumber: 'REL-002',
          number: 'REL-002',
          customerName: 'XYZ Corp',
          shipToName: 'Dock B',
          status: 'Entered',
          statusChangedAt: new Date(Date.now() - 1 * 60 * 60 * 1000), // 1 hour ago
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        },
        {
          ReleaseNumber: 'REL-003',
          number: 'REL-003',
          customerName: 'Global Logistics',
          stagingLocation: 'Zone C-3',
          status: 'Staged',
          statusChangedAt: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
          stagedBy: 'John Smith',
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        },
        {
          ReleaseNumber: 'REL-004',
          number: 'REL-004',
          customerName: 'Tech Solutions',
          stagingLocation: 'Zone A-1',
          status: 'Staged',
          statusChangedAt: new Date(Date.now() - 45 * 60 * 1000), // 45 minutes ago
          stagedBy: 'Jane Doe',
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        },
        {
          ReleaseNumber: 'REL-005',
          number: 'REL-005',
          customerName: 'Supply Chain Inc',
          shipToName: 'Distribution Center',
          status: 'Loaded',
          statusChangedAt: new Date(Date.now() - 4 * 60 * 60 * 1000), // 4 hours ago
          loadedAt: new Date(Date.now() - 4 * 60 * 60 * 1000),
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp(),
          attachments: {
            releaseDocUrl: 'https://example.com/release-doc.pdf'
          }
        },
        {
          ReleaseNumber: 'REL-006',
          number: 'REL-006',
          customerName: 'Retail Partners',
          shipToName: 'Store #123',
          status: 'Loaded',
          statusChangedAt: new Date(Date.now() - 30 * 60 * 1000), // 30 minutes ago
          loadedAt: new Date(Date.now() - 30 * 60 * 1000),
          carrierMode: 'CustomerArranged',
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        }
      ];
      
      for (const release of testReleases) {
        try {
          await addDoc(releasesRef, release);
          addLog(`✓ Added ${release.ReleaseNumber} (${release.status})`, 'success');
        } catch (error) {
          addLog(`✗ Failed to add ${release.ReleaseNumber}: ${error.message}`, 'error');
        }
      }
      
      addLog('Seeding complete!', 'success');
      seedBtn.disabled = false;
    });
    
    clearBtn.addEventListener('click', async () => {
      clearBtn.disabled = true;
      log.innerHTML = '';
      addLog('Clearing all releases...');
      
      try {
        const releasesRef = collection(db, 'releases');
        const snapshot = await getDocs(releasesRef);
        
        for (const docSnap of snapshot.docs) {
          await deleteDoc(doc(db, 'releases', docSnap.id));
          addLog(`✓ Deleted ${docSnap.data().ReleaseNumber || docSnap.id}`, 'success');
        }
        
        addLog('All releases cleared!', 'success');
      } catch (error) {
        addLog(`✗ Error clearing releases: ${error.message}`, 'error');
      }
      
      clearBtn.disabled = false;
    });
  </script>
</body>
</html>